{% extends 'my_calendar/shablon.html' %}

{% block content %}
    <h1>Календарь событий</h1>

    {% load static %}
    <link rel="stylesheet" href="{% static 'my_calendar/css/my_calendar.css' %}">

    <table id="mainTable">
        <tr>
            {% for month, details in events.items %}
            <th>{{ month }}</th>
            {% endfor %}
        </tr>
        <tr>
            {% for month, events_list in events.items %}
            <th>

                {% for event in events_list %}
                        <div class="event-card">
                            <div class="event-name">{{ event.name }}</div>
                            <div class="event-interest">{{ event.interest }}</div>
                            <div class="event-organizer">организатор: {{ event.organizer }}</div>
                            <div class="event-details"> <!-- Контейнер для даты и времени -->
                                <div class="event-date">{{ event.date }}</div>
                                <div class="event-time">{{ event.time }}</div>
                            </div>
                            <button id="event-subscribe"
                                    class="event-subscribe {% if details.subscribe %}unsubscribed{% else %}subscribed{% endif %}"
                                    data-subscribed="{{ event.subscribe }}">
                                {% if event.subscribe %}
                                    Отписаться
                                {% else %}
                                    Подписаться
                                {% endif %}
                            </button>
                        </div>

                {% endfor %}
            </th>
            {% endfor %}
        </tr>
        <tr>

        </tr>
    </table>
    <script>
        if (window.innerWidth <= 400) {
            location.href = "#mainTable";
        }

        // Получаем значение подписки из Django шаблона
        let isSubscribed = {{ details.subscribe|lower }}; // Преобразуем в lowercase для JavaScript (True/False в виде строки)
<!--        isSubscribed = false;-->
        const subscribeButton = document.getElementById('event-subscribe');

        // Устанавливаем стиль и текст кнопки в зависимости от значения isSubscribed
        if (isSubscribed === 'true') {
            subscribeButton.classList.add('unsubscribed');
            subscribeButton.classList.remove('subscribed');
            subscribeButton.textContent = 'Отписаться';
        } else {
            subscribeButton.classList.add('subscribed');
            subscribeButton.classList.remove('unsubscribed');
            subscribeButton.textContent = 'Подписаться';
        }

        // Обработчик клика для кнопки
        subscribeButton.addEventListener('click', function() {
            if (isSubscribed === 'true') {
                // Логика для отписки
                console.log('Вы отписались от мероприятия.');
                // Здесь можно также обновить состояние на сервере
                subscribeButton.textContent = 'Подписаться';
                subscribeButton.classList.remove('unsubscribed');
                subscribeButton.classList.add('subscribed');
                isSubscribed = 'false'; // Обновляем состояние подписки
            } else {
                // Логика для подписки
                console.log('Вы подписались на мероприятие.');
                // Здесь можно также обновить состояние на сервере
                subscribeButton.textContent = 'Отписаться';
                subscribeButton.classList.remove('subscribed');
                subscribeButton.classList.add('unsubscribed');
                isSubscribed = 'true'; // Обновляем состояние подписки
            }
        });

        html {
            scroll-behavior: smooth; /* Плавная прокрутка при переходе по якорям */
        }
        window.onload = function() {
            window.scrollTo(0, 0); // Прокрутка в начало страницы
        };

        window.onresize = function() {
            window.scrollTo(0, 0); // Прокрутка в начало страницы при изменении размера
        };
    </script>
{% endblock %}
